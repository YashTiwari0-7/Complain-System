<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Login | Elevare Campus</title>
    <link rel="stylesheet" href="studentLogin.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-light-grey full-height">

    <nav class="navbar">
        <div class="container nav-container">
            <div class="logo">Elevare Campus</div>
            <a href="../landing.html" class="btn-back">‚Üê Back to Home</a>
        </div>
    </nav>

    <main class="login-wrapper">
        <div class="login-card">
            <div class="login-header">
                <h1>Student Login</h1>
                <p>Access your grievance dashboard</p>
            </div>

            <form id="studentLoginForm" method="POST" class="login-form">
                <div class="form-group">
                    <label for="rollno">University Roll Number</label>
                    <input type="text" id="rollno" name="rollno" placeholder="e.g. 2100540..." required>
                </div>

                <div class="form-group">
                    <label for="dob">Date of Birth</label>
                    <input type="date" id="dob" name="dob" required>
                </div>

                <div class="form-group">
                    <label for="mobile">Mobile Number (Password)</label>
                    <div class="password-wrapper">
                        <input type="password" id="mobile" name="mobile" placeholder="10-digit number" pattern="[0-9]{10}" required>
                        <button type="button" class="toggle-btn" onclick="togglePass()">üëÅÔ∏è</button>
                    </div>
                </div>

                <div class="submit-container">
                    <button type="submit" class="btn btn-primary btn-submit">Sign In</button>
                </div>
            </form>

            <div class="login-footer">
                <p>Having trouble? <a href="#">Contact Registrar Office</a></p>
            </div>
        </div>
    </main>

<script>
    if (!localStorage.getItem("rollNo")) {
  window.location.href = "studentLogin.html";
}
const form = document.getElementById("studentLoginForm");

form.addEventListener("submit", async (e) => {
  e.preventDefault();

  const rollNo = document.getElementById("rollno").value.trim();
  const dob = document.getElementById("dob").value;
  const mobile = document.getElementById("mobile").value.trim();

  try {
    const res = await fetch("http://localhost:5000/api/student-login", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ rollNo, dob, mobile })
    });

    const data = await res.json();

    if (res.ok) {
      // Save session data
      localStorage.setItem("rollNo", data.student.rollNo);
      localStorage.setItem("studentName", data.student.studentName);

      window.location.href = "studentDashboard.html";
    } else {
      alert(data.message);
    }

  } catch (err) {
    alert("Server connection error");
  }
});
</script>

</body>
</html>